PA EQU 30H
PB EQU 31H
CA EQU 32H
CB EQU 33H
N_F10 EQU 10
EOI EQU 20H
IMR EQU 21H
INT_0 EQU 24H


ORG 1000H
FLAG DB 0
LONGITUD DB 0
CADENA DB ?


ORG 40
IP_F10 DW DIR_F10

ORG 3000H

DIR_F10: MOV AL, 0FFH
OUT IMR, AL ; ENMASCARO PARA QUE LUEGO DE APRETAR F10 YA NO SE PUEDA INTERRUMPIR

MOV FLAG, 1

MOV AL, EOI
OUT EOI, AL
IRET


ORG 2000H

CLI
; CA (ENTRADA/SALIDA) (STROBE EN SALIDA - BUSY EN ENTRADA)
MOV AL, 0FDH ; 11111101B
OUT CA, AL

;CB (SALIDA)
MOV AL, 0
OUT CB, AL

; INICIO STROBE EN 0 Y BUSY EN 1
IN AL, PA
AND AL, 0FDH
OUT PA, AL


; IMR
MOV AL, 0FEH
OUT IMR, AL

; INT 0
MOV AL, N_F10
OUT INT_0, AL
STI


MOV BX, OFFSET CADENA
OTRO_CAR: INT 6
INC BX
INC LONGITUD
CMP FLAG, 0
JZ OTRO_CAR

MOV BX, OFFSET CADENA

; POLL
POLL: IN AL, PA
AND AL, 1
JNZ DIR_F10

; CARGO DATO (PB)
MOV AL, [BX]
OUT PB, AL

; STROBE EN 1 (AVISO A LA IMPRESORA QUE ESTA EL DATO DISPONIBLE)
IN AL, PA
OR AL, 2
OUT PA, AL

; STROBE EN 0 (REINICIO STROBE EN 0 PARA VOLVER A HACER ENCUESTA/POLL)
IN AL, PA
AND AL, 0FDH
OUT PA, AL

INC BX
DEC LONGITUD
JNZ POLL


HLT
END