PA EQU 30H
PB EQU 31H
CA EQU 32H
CB EQU 33H
N_CLK EQU 10
EOI EQU 20H
IMR EQU 21H
INT_1 EQU 25H
TIMER EQU 10H

ORG 40
IP_CLK DW DIR_CLK

ORG 1000H
VECTOR DB 1, 2, 4, 8, 16, 32, 64, 128, 128, 64, 32, 16, 8, 4, 2, 1
FIN_V DB ?

ORG 3000H
DIR_CLK: PUSH AX
MOV AL, [BX]
OUT PB, AL
INC BX
DEC CL

JNZ SIGUE

MOV BX, OFFSET VECTOR
MOV AL, OFFSET FIN_V - OFFSET VECTOR

SIGUE: MOV AL, 0
OUT TIMER, AL

MOV AL, EOI
OUT EOI, AL

POP AX

IRET


ORG 2000H

CLI

MOV AL, 0
OUT CB, AL ; CB AHORA EN SALIDA


MOV AL, 0FDH
OUT IMR, AL ; IMR AHORA ENMASCARA INT1 (TIMER)

MOV AL, N_CLK
OUT INT_1, AL ; INT1 TIEEN DIR DE RUTINA

MOV AL, 1
OUT TIMER+1, AL ; COMPARADOR = 1

MOV AL, 0
OUT TIMER, AL ; CONTADOR = 0

STI

MOV BX, OFFSET VECTOR
MOV CL, OFFSET FIN_V - OFFSET VECTOR
LAZO: JMP LAZO

HLT
END